(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();class g{constructor(){this.selectedColors=new Set,this.currentCommander=null,this.filters={colors:[],bracket:"",manaMin:1,manaMax:10},this.scryfallAPI="https://api.scryfall.com",this.lastScryfallRequest=0,this.scryfallDelay=75,this.cache=new Map,this.cacheTimeout=10*60*1e3,this.commanderQueue=[],this.queueSize=10,this.minQueueSize=3,this.initializeEventListeners(),this.updateManaFilter()}initializeEventListeners(){document.querySelectorAll(".color-btn").forEach(t=>{t.addEventListener("click",e=>this.toggleColor(e.target.dataset.color))}),document.querySelectorAll('input[name="mana-filter"]').forEach(t=>{t.addEventListener("change",()=>this.updateManaFilter())}),document.getElementById("mana-min-input").addEventListener("input",()=>this.updateCustomManaValues()),document.getElementById("mana-max-input").addEventListener("input",()=>this.updateCustomManaValues()),document.getElementById("apply-filters").addEventListener("click",()=>this.findCommander()),document.getElementById("reject-btn").addEventListener("click",()=>this.rejectCommander()),document.getElementById("accept-btn").addEventListener("click",()=>this.acceptCommander()),document.getElementById("new-search").addEventListener("click",()=>this.resetToFilters()),this.initializeSwipe()}initializeSwipe(){const t=document.getElementById("card-container");if(!t){console.log("Card container not found");return}const e=t.cloneNode(!0);t.parentNode.replaceChild(e,t);let a=0,n=0,r=0,o=0,c=!1;console.log("Swipe initialized for card container"),e.addEventListener("mousedown",s=>{e.querySelector(".commander-card")&&(c=!0,a=s.clientX,n=s.clientY,e.style.cursor="grabbing",document.body.style.overflow="hidden",console.log("Mouse down - drag started"),s.preventDefault())}),document.addEventListener("mousemove",s=>{if(!c)return;s.preventDefault(),r=s.clientX-a,o=s.clientY-n;const i=e.querySelector(".commander-card");if(i){const l=r/20;i.style.transform=`translate(${r}px, ${o}px) rotate(${l}deg)`,i.style.transition="none",Math.abs(r)>50&&(r>0?(i.style.borderColor="#4caf50",console.log("Swiping right (accept)")):(i.style.borderColor="#ff5252",console.log("Swiping left (reject)")))}}),document.addEventListener("mouseup",()=>{if(!c)return;console.log("Mouse up - checking swipe distance:",r),c=!1,e.style.cursor="grab",document.body.style.overflow="";const s=e.querySelector(".commander-card");if(s)if(Math.abs(r)>100){console.log("Swipe threshold met! Direction:",r>0?"right":"left");const i=r>0?1:-1;s.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",s.style.transform=`translate(${i*1e3}px, ${o}px) rotate(${i*30}deg)`,s.style.opacity="0",setTimeout(()=>{r>0?(console.log("Accepting commander"),this.acceptCommander()):(console.log("Rejecting commander"),this.rejectCommander())},300)}else console.log("Swipe too short, snapping back"),s.style.transition="transform 0.3s ease-out, border-color 0.3s ease-out",s.style.transform="translate(0, 0) rotate(0deg)",s.style.borderColor="transparent";r=0,o=0}),e.addEventListener("touchstart",s=>{e.querySelector(".commander-card")&&(c=!0,a=s.touches[0].clientX,n=s.touches[0].clientY,document.body.style.overflow="hidden",console.log("Touch start - drag started"),s.preventDefault())},{passive:!1}),e.addEventListener("touchmove",s=>{if(!c)return;s.preventDefault(),r=s.touches[0].clientX-a,o=s.touches[0].clientY-n;const i=e.querySelector(".commander-card");if(i){const l=r/20;i.style.transform=`translate(${r}px, ${o}px) rotate(${l}deg)`,i.style.transition="none",Math.abs(r)>50&&(r>0?i.style.borderColor="#4caf50":i.style.borderColor="#ff5252")}},{passive:!1}),e.addEventListener("touchend",()=>{if(!c)return;console.log("Touch end - checking swipe distance:",r),c=!1,document.body.style.overflow="";const s=e.querySelector(".commander-card");if(s)if(Math.abs(r)>100){console.log("Touch swipe threshold met!");const i=r>0?1:-1;s.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",s.style.transform=`translate(${i*1e3}px, ${o}px) rotate(${i*30}deg)`,s.style.opacity="0",setTimeout(()=>{r>0?this.acceptCommander():this.rejectCommander()},300)}else s.style.transition="transform 0.3s ease-out, border-color 0.3s ease-out",s.style.transform="translate(0, 0) rotate(0deg)",s.style.borderColor="transparent";r=0,o=0}),e.addEventListener("touchcancel",()=>{c&&(c=!1,document.body.style.overflow="")})}toggleColor(t){const e=document.querySelector(`[data-color="${t}"]`);this.selectedColors.has(t)?(this.selectedColors.delete(t),e.classList.remove("active")):(this.selectedColors.add(t),e.classList.add("active"))}async rateLimitedScryfallRequest(t,e=null){const n=Date.now()-this.lastScryfallRequest;if(n<this.scryfallDelay){const r=this.scryfallDelay-n;await new Promise(o=>setTimeout(o,r))}this.lastScryfallRequest=Date.now();try{const r=t+(e?"?"+new URLSearchParams(e):""),o=await fetch(r,{method:"GET",headers:{Accept:"application/json","User-Agent":"MTGCommanderPicker/1.0 (randomcommander.xyz)"},mode:"cors"});if(!o.ok)throw new Error(`Scryfall API error: ${o.status}`);return await o.json()}catch(r){throw console.error("Scryfall request failed:",r),r}}getCacheKey(t,e){return`${t}:${JSON.stringify(e)}`}getFromCache(t){const e=this.cache.get(t);return e&&Date.now()-e.timestamp<this.cacheTimeout?e.data:(this.cache.delete(t),null)}setCache(t,e){if(this.cache.set(t,{data:e,timestamp:Date.now()}),this.cache.size>100){const a=Date.now()-this.cacheTimeout;for(const[n,r]of this.cache.entries())r.timestamp<a&&this.cache.delete(n)}}updateManaFilter(){const t=document.querySelector('input[name="mana-filter"]:checked').value,e=document.getElementById("custom-mana-controls");if(t==="custom")e.style.display="block",this.updateCustomManaValues();else switch(e.style.display="none",t){case"any":this.filters.manaMin=0,this.filters.manaMax=15;break;case"low":this.filters.manaMin=1,this.filters.manaMax=3;break;case"mid":this.filters.manaMin=4,this.filters.manaMax=6;break;case"high":this.filters.manaMin=7,this.filters.manaMax=15;break}}updateCustomManaValues(){const t=document.getElementById("mana-min-input"),e=document.getElementById("mana-max-input");let a=parseInt(t.value),n=parseInt(e.value);a>n&&(document.activeElement===t?(n=a,e.value=n):(a=n,t.value=a)),this.filters.manaMin=a,this.filters.manaMax=n}async findCommander(){this.filters.colors=Array.from(this.selectedColors),this.filters.bracket=document.getElementById("bracket-filter").value,this.commanderQueue=[];const t=this.getCacheKey("commander",this.filters),e=this.getFromCache(t);if(e){this.currentCommander=e,document.getElementById("card-section").style.display="block",document.getElementById("deck-suggestions").style.display="none",this.displayCommander(),this.prefetchCommanders();return}document.getElementById("card-section").style.display="block",document.getElementById("deck-suggestions").style.display="none",document.getElementById("loading-screen").style.display="block",document.getElementById("swipe-hint").style.display="none",document.getElementById("card-container").style.display="none",document.getElementById("swipe-buttons").style.display="none";try{if(await this.prefetchCommanders(),this.commanderQueue.length>0)this.currentCommander=this.commanderQueue.shift(),this.setCache(t,this.currentCommander),this.displayCommander();else throw new Error("No commanders found")}catch(a){console.error("Error fetching commander:",a),document.getElementById("loading-screen").innerHTML='<div style="text-align: center; padding: 40px; color: #ff5252;">‚ùå Error loading commander. Please try again.</div>'}}async prefetchCommanders(){console.log("Prefetching commanders... Current queue size:",this.commanderQueue.length);let t="is:commander";if(this.filters.colors.length>0){const e=this.filters.colors.join("");t+=` id:${e}`}if(t+=` mv>=${this.filters.manaMin} mv<=${this.filters.manaMax}`,this.filters.bracket){const e=parseInt(this.filters.bracket);e===1?t+=" -is:reserved (rarity:common OR rarity:uncommon)":e===5&&(t+=" (is:reserved OR rarity:mythic)")}console.log("Scryfall query:",t);try{const e={q:t,order:"random"},a=await this.rateLimitedScryfallRequest(`${this.scryfallAPI}/cards/search`,e);if(!a.data||a.data.length===0){const o={q:"is:commander",order:"random"},c=await this.rateLimitedScryfallRequest(`${this.scryfallAPI}/cards/search`,o);if(c.data&&c.data.length>0){const i=this.shuffleArray(c.data).slice(0,this.queueSize);for(const l of i)await this.processAndQueueCommander(l);console.log("Prefetched",i.length,"commanders (fallback)");return}throw new Error("No commanders found")}const r=this.shuffleArray(a.data).slice(0,this.queueSize);for(const o of r)await this.processAndQueueCommander(o);console.log("Prefetched",r.length,"commanders. Queue size:",this.commanderQueue.length)}catch(e){throw console.error("Error prefetching commanders:",e),e}}async fetchRandomCommander(){if(this.commanderQueue.length<this.minQueueSize&&(console.log("Queue low, prefetching more commanders..."),await this.prefetchCommanders()),this.commanderQueue.length>0){const t=this.commanderQueue.shift();return console.log("Got commander from queue:",t.name,"- Remaining in queue:",this.commanderQueue.length),this.commanderQueue.length<this.minQueueSize&&this.prefetchCommanders().catch(e=>console.log("Background prefetch failed:",e)),t}return console.log("Queue empty, fetching single commander..."),await this.fetchSingleCommander()}async fetchSingleCommander(){let t="is:commander";if(this.filters.colors.length>0){const r=this.filters.colors.join("");t+=` id:${r}`}if(t+=` mv>=${this.filters.manaMin} mv<=${this.filters.manaMax}`,this.filters.bracket){const r=parseInt(this.filters.bracket);r===1?t+=" -is:reserved (rarity:common OR rarity:uncommon)":r===5&&(t+=" (is:reserved OR rarity:mythic)")}console.log("Scryfall query:",t);const e={q:t,order:"random"},a=await this.rateLimitedScryfallRequest(`${this.scryfallAPI}/cards/search`,e);if(!a.data||a.data.length===0){const r={q:"is:commander",order:"random"},o=await this.rateLimitedScryfallRequest(`${this.scryfallAPI}/cards/search`,r);if(o.data&&o.data.length>0)return this.processCommanderCard(o.data[0]);throw new Error("No commanders found")}const n=a.data[Math.floor(Math.random()*Math.min(a.data.length,20))];return this.processCommanderCard(n)}shuffleArray(t){const e=[...t];for(let a=e.length-1;a>0;a--){const n=Math.floor(Math.random()*(a+1));[e[a],e[n]]=[e[n],e[a]]}return e}async processAndQueueCommander(t){var n,r,o;const e=((n=t.oracle_text)==null?void 0:n.toLowerCase())||"";if(((r=t.keywords)==null?void 0:r.includes("Partner"))||e.includes("partner")){const c=(o=t.oracle_text)==null?void 0:o.match(/Partner with ([^(\n]+)/i);if(c){const s=c[1].trim();console.log(`${t.name} has Partner with ${s}, fetching specific partner...`);try{const i=await this.fetchSpecificPartner(s);if(i){const l=this.processCommanderCard(t,i);this.commanderQueue.push(l);return}}catch(i){console.log("Failed to fetch specific partner, using solo:",i)}}else if(!e.includes("partner with")){console.log(`${t.name} has Partner, fetching a random partner...`);try{const s=await this.fetchPartnerCommander(t);if(s){const i=this.processCommanderCard(t,s);this.commanderQueue.push(i);return}}catch(s){console.log("Failed to fetch partner, using solo:",s)}}}this.commanderQueue.push(this.processCommanderCard(t))}async fetchSpecificPartner(t){try{return await this.rateLimitedScryfallRequest(`${this.scryfallAPI}/cards/named`,{fuzzy:t})||null}catch(e){return console.error("Error fetching specific partner:",e),null}}async fetchPartnerCommander(t){const e='is:commander (o:"partner" OR keyword:partner) -o:"partner with"';try{const a=await this.rateLimitedScryfallRequest(`${this.scryfallAPI}/cards/search`,{q:e,order:"random"});if(a.data&&a.data.length>0)return a.data.find(r=>r.id!==t.id)||null}catch(a){console.error("Error fetching partner:",a)}return null}processCommanderCard(t,e=null){var o,c,s,i;let a=t.color_identity||[],n=[...a];if(e){const l=e.color_identity||[];n=[...new Set([...a,...l])].sort()}let r=2;return(t.reserved||t.rarity==="mythic")&&(r=Math.max(r,4)),t.edhrec_rank&&t.edhrec_rank<100&&(r=5),t.edhrec_rank&&t.edhrec_rank>5e3&&(r=1),n.length>=4&&(r=Math.max(r,3)),e&&e.edhrec_rank&&e.edhrec_rank<100&&(r=Math.max(r,5)),{name:e?`${t.name} & ${e.name}`:t.name,colors:n,manaValue:t.cmc||0,bracket:r,type:t.type_line,imageUrl:((o=t.image_uris)==null?void 0:o.normal)||((c=t.image_uris)==null?void 0:c.large)||"",scryfallId:t.id,oracleText:t.oracle_text||"",explanation:e?this.generatePartnerExplanation(t,e):this.generateExplanation(t),deckSuggestions:null,partner:e?{name:e.name,imageUrl:((s=e.image_uris)==null?void 0:s.normal)||((i=e.image_uris)==null?void 0:i.large)||"",type:e.type_line,oracleText:e.oracle_text||""}:null}}generatePartnerExplanation(t,e){return`This partner pairing gives you access to ${[...new Set([...t.color_identity||[],...e.color_identity||[]])].length} colors and combines ${t.name}'s abilities with ${e.name}'s strengths. Partner commanders offer incredible flexibility and synergy potential!`}generateRandomCommander(){const t=[{name:"Atraxa, Praetors' Voice",colors:["W","U","B","G"],manaValue:4,bracket:4,type:"Legendary Creature ‚Äî Phyrexian Angel Horror",imageUrl:"https://cards.scryfall.io/normal/front/d/0/d0d33d52-3d28-4635-b985-51e126289259.jpg",explanation:"Atraxa is perfect for +1/+1 counters, planeswalkers, or infect strategies. Her proliferate ability doubles down on any counter-based strategy, and her four-color identity gives you access to incredible versatility.",deckSuggestions:{"Ramp & Fixing":["Chromatic Lantern","Farseek","Cultivate","Kodama's Reach"],"Proliferate Synergy":["Inexorable Tide","Contagion Engine","Viral Drake","Thrummingbird"],Planeswalkers:["Jace, the Mind Sculptor","Elspeth, Knight-Errant","Vraska the Unseen","Garruk Wildspeaker"],Protection:["Heroic Intervention","Teferi's Protection","Counterspell","Path to Exile"]}},{name:"Rhys the Redeemed",colors:["W","G"],manaValue:1,bracket:2,type:"Legendary Creature ‚Äî Elf Warrior",imageUrl:"https://cards.scryfall.io/normal/front/b/9/b91dadcb-31e9-43b0-b425-c9311af3e9d7.jpg",explanation:"Rhys excels at token strategies and going wide. His low mana cost means early pressure, and his abilities scale incredibly well into the late game. Perfect for players who love overwhelming opponents with creatures.",deckSuggestions:{"Token Generators":["Parallel Lives","Doubling Season","Anointed Procession","Rhys the Exiled"],"Anthem Effects":["Intangible Virtue","Honor of the Pure","Glorious Anthem","Collective Blessing"],Ramp:["Sol Ring","Selesnya Signet","Rampant Growth","Nature's Lore"],Protection:["Heroic Intervention","Rootborn Defenses","Make a Stand","Unbreakable Formation"]}},{name:"Krenko, Mob Boss",colors:["R"],manaValue:4,bracket:3,type:"Legendary Creature ‚Äî Goblin Warrior",imageUrl:"https://cards.scryfall.io/normal/front/c/d/cd9fec9d-23c8-4d35-97c1-9499527198fb.jpg",explanation:"Krenko is the ultimate goblin tribal commander. He creates explosive turns and can quickly overwhelm opponents with sheer numbers. Great for aggressive players who want to see big numbers fast.",deckSuggestions:{"Goblin Tribal":["Goblin Chieftain","Goblin King","Goblin Warchief","Siege-Gang Commander"],"Token Support":["Purphoros, God of the Forge","Impact Tremors","Goblin Bombardment","Skirk Prospector"],"Haste Enablers":["Fervor","Mass Hysteria","Hammer of Purphoros","Urabrask the Hidden"],"Card Draw":["Skullclamp","Wheel of Fortune","Reforge the Soul","Faithless Looting"]}},{name:"Meren of Clan Nel Toth",colors:["B","G"],manaValue:4,bracket:3,type:"Legendary Creature ‚Äî Human Shaman",imageUrl:"https://cards.scryfall.io/normal/front/1/7/17d6703c-ad79-457b-a1b5-c2284e363085.jpg",explanation:"Meren rewards you for creatures dying and coming back. She's perfect for graveyard value strategies, sacrifice synergies, and controlling the board through recursive threats.",deckSuggestions:{"Sacrifice Outlets":["Viscera Seer","Carrion Feeder","Ashnod's Altar","Phyrexian Altar"],Recursion:["Eternal Witness","Regrowth","Reanimate","Animate Dead"],"Value Creatures":["Sakura-Tribe Elder","Wood Elves","Solemn Simulacrum","Acidic Slime"],Removal:["Beast Within","Putrefy","Abrupt Decay","Maelstrom Pulse"]}},{name:"Talrand, Sky Summoner",colors:["U"],manaValue:4,bracket:2,type:"Legendary Creature ‚Äî Merfolk Wizard",imageUrl:"https://cards.scryfall.io/normal/front/9/f/9f4e8d4c-79f8-4313-bdb4-2062d8f5299b.jpg",explanation:"Talrand turns every instant and sorcery into a threat. He's perfect for control players who want to win through incremental advantage while protecting themselves with counterspells and removal.",deckSuggestions:{Counterspells:["Counterspell","Mana Drain","Force of Will","Pact of Negation"],"Card Draw":["Rhystic Study","Mystic Remora","Fact or Fiction","Blue Sun's Zenith"],"Cheap Spells":["Brainstorm","Ponder","Preordain","Opt"],"Win Conditions":["Coat of Arms","Favorable Winds","Gravitational Shift","Bident of Thassa"]}},{name:"Thrasios & Tymna",colors:["W","U","G"],manaValue:4,bracket:5,type:"Legendary Creature ‚Äî Merfolk Wizard // Legendary Creature ‚Äî Human Cleric",imageUrl:"https://cards.scryfall.io/normal/front/f/2/f21f99ef-d6f4-4128-b778-de68ec7e79b6.jpg",explanation:"The ultimate cEDH partnership. Thrasios provides card advantage and mana sink, while Tymna draws cards off combat damage. Together they enable fast combo wins with incredible consistency and interaction.",deckSuggestions:{"Fast Mana":["Mana Crypt","Sol Ring","Mana Vault","Chrome Mox"],Tutors:["Demonic Tutor","Vampiric Tutor","Enlightened Tutor","Mystical Tutor"],"Combo Pieces":["Thassa's Oracle","Demonic Consultation","Tainted Pact","Laboratory Maniac"],Interaction:["Force of Will","Mental Misstep","Swords to Plowshares","Assassin's Trophy"]}},{name:"Kinnan, Bonder Prodigy",colors:["U","G"],manaValue:2,bracket:5,type:"Legendary Creature ‚Äî Human Druid",imageUrl:"https://cards.scryfall.io/normal/front/6/3/63cda4a0-0dff-4edb-ae67-a2b7e2971350.jpg",explanation:"Kinnan is a cEDH powerhouse that doubles mana from creatures and artifacts. He enables explosive turns and can consistently threaten wins by turn 3-4 through various infinite mana combos.",deckSuggestions:{"Mana Dorks":["Birds of Paradise","Elvish Mystic","Deathrite Shaman","Bloom Tender"],"Combo Enablers":["Basalt Monolith","Grim Monolith","Rings of Brighthearth","Freed from the Real"],"Win Conditions":["Thassa's Oracle","Blue Sun's Zenith","Walking Ballista","Finale of Devastation"],Protection:["Force of Will","Force of Negation","Veil of Summer","Heroic Intervention"]}}];let e=t.filter(a=>{if(this.filters.colors.length>0){const n=this.filters.colors.every(o=>a.colors.includes(o)),r=a.colors.every(o=>this.filters.colors.includes(o));if(!n||!r)return!1}return!(this.filters.bracket&&a.bracket!==parseInt(this.filters.bracket)||a.manaValue<this.filters.manaMin||a.manaValue>this.filters.manaMax)});return e.length===0&&(e=t),e[Math.floor(Math.random()*e.length)]}displayCommander(){console.log("Displaying commander:",this.currentCommander.name);const t=document.getElementById("loading-screen");t.innerHTML=`
            <div class="loading-spinner"></div>
            <p>Finding your perfect commander...</p>
        `,t.style.display="none",document.getElementById("swipe-hint").style.display="block",document.getElementById("card-container").style.display="block",document.getElementById("swipe-buttons").style.display="flex";const e=document.getElementById("card-container"),a=this.currentCommander;e.style.opacity="1",e.style.transform="",e.style.transition="",a.partner?e.innerHTML=`
                <div class="commander-card partner-card">
                    <div class="partner-images">
                        <img class="partner-img" src="${a.imageUrl}" alt="${a.name.split(" & ")[0]}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk1URyBDYXJkPC90ZXh0Pjwvc3ZnPg=='">
                        <img class="partner-img" src="${a.partner.imageUrl}" alt="${a.partner.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk1URyBDYXJkPC90ZXh0Pjwvc3ZnPg=='">
                    </div>
                    <div class="card-info">
                        <h2 id="card-name">${a.name}</h2>
                        <p id="card-type">Partner Commanders</p>
                        <p style="margin-bottom: 10px;"><strong>Combined Colors:</strong> ${a.colors.length} | <strong>Bracket:</strong> ${a.bracket}</p>
                        <div class="explanation" id="explanation">
                            <strong>Why build this deck?</strong><br>
                            ${a.explanation}
                        </div>
                    </div>
                </div>
            `:e.innerHTML=`
                <div class="commander-card">
                    <img id="card-image" src="${a.imageUrl}" alt="${a.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk1URyBDYXJkPC90ZXh0Pjwvc3ZnPg=='">
                    <div class="card-info">
                        <h2 id="card-name">${a.name}</h2>
                        <p id="card-type">${a.type}</p>
                        <p style="margin-bottom: 10px;"><strong>Mana Value:</strong> ${a.manaValue} | <strong>Bracket:</strong> ${a.bracket}</p>
                        <div class="explanation" id="explanation">
                            <strong>Why build this deck?</strong><br>
                            ${a.explanation}
                        </div>
                    </div>
                </div>
            `,console.log("Re-initializing swipe for new card"),this.initializeSwipe()}async fetchCardsByQuery(t,e=6){try{const a={q:t,order:"edhrec",unique:"cards"},n=await this.rateLimitedScryfallRequest(`${this.scryfallAPI}/cards/search`,a);return n.data?n.data.slice(0,e).map(r=>r.name):[]}catch(a){return console.error("Error fetching cards by query:",a),[]}}async acceptCommander(){console.log("Accept commander called"),document.getElementById("card-section").style.display="none",document.getElementById("deck-suggestions").style.display="block";const t=document.getElementById("deck-content");t.innerHTML='<div style="text-align: center; padding: 40px;">üìä Fetching popular cards from EDHREC...</div>';try{await this.fetchDeckSuggestions(),this.displayDeckSuggestions()}catch(e){console.error("Error fetching deck suggestions:",e),t.innerHTML='<div style="text-align: center; padding: 40px; color: #ff5252;">‚ùå Error loading deck suggestions. Using basic recommendations.</div>',this.displayBasicDeckSuggestions()}}async fetchDeckSuggestions(){if(!this.currentCommander.name)throw new Error("No commander name available");try{const t=await this.scrapeEDHRECData(this.currentCommander.name);if(t&&Object.keys(t).length>0)this.currentCommander.deckSuggestions=t;else throw new Error("No EDHREC data available")}catch(t){console.log("EDHREC scraping failed, using Scryfall recommendations:",t),this.currentCommander.deckSuggestions=await this.generateScryfallSuggestions()}}async scrapeEDHRECData(t){const a=`https://edhrec.com/commanders/${t.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"-")}`;try{const n=`https://api.allorigins.win/get?url=${encodeURIComponent(a)}`,r=await fetch(n);if(!r.ok)throw new Error("Failed to fetch EDHREC data");const c=(await r.json()).contents;return this.parseEDHRECHTML(c)}catch(n){return console.error("EDHREC scraping error:",n),null}}parseEDHRECHTML(t){const a=new DOMParser().parseFromString(t,"text/html"),n={};try{return a.querySelectorAll(".cardview-container, .card-grid, .cardlist").forEach((o,c)=>{var l;const s=[];if(o.querySelectorAll('.card-name, .cardview-name, [data-card-name], .card-title, a[href*="/cards/"]').forEach(d=>{var h;let m=((h=d.textContent)==null?void 0:h.trim())||d.getAttribute("data-card-name")||d.getAttribute("title");m&&m.length>2&&!s.includes(m)&&s.push(m)}),s.length>0){const d=o.querySelector("h2, h3, .section-title, .cardlist-title"),m=((l=d==null?void 0:d.textContent)==null?void 0:l.trim())||`Category ${c+1}`;n[m]=s.slice(0,8)}}),Object.keys(n).length===0?this.parseEDHRECAlternative(a):n}catch(r){return console.error("Error parsing EDHREC HTML:",r),{}}}parseEDHRECAlternative(t){const e={"Popular Cards":[],Creatures:[],"Instants & Sorceries":[],"Artifacts & Enchantments":[]};return t.querySelectorAll('a[href*="/cards/"], a[href*="scryfall.com"]').forEach(n=>{var o;const r=(o=n.textContent)==null?void 0:o.trim();r&&r.length>2&&e["Popular Cards"].push(r)}),Object.keys(e).forEach(n=>{e[n]=[...new Set(e[n])].slice(0,8)}),Object.keys(e).forEach(n=>{e[n].length===0&&delete e[n]}),e}async generateScryfallSuggestions(){const t=this.currentCommander.colors,e={};try{const a=t.length>0?`id:${t.join("")}`:"",n=`${a} (o:"search your library for" OR o:"add mana") type:instant OR type:sorcery`,r=await this.fetchCardsByQuery(n,6);r.length>0&&(e["Ramp & Fixing"]=r);const o=`${a} (o:"destroy" OR o:"exile") -type:creature`,c=await this.fetchCardsByQuery(o,6);c.length>0&&(e.Removal=c);const s=`${a} o:"draw" type:instant OR type:sorcery OR type:enchantment`,i=await this.fetchCardsByQuery(s,6);i.length>0&&(e["Card Draw"]=i);const l=`${a} type:creature cmc<=4`,d=await this.fetchCardsByQuery(l,8);d.length>0&&(e.Creatures=d)}catch(a){console.error("Error generating Scryfall suggestions:",a)}return Object.keys(e).length===0&&(e.Staples=["Sol Ring","Command Tower","Arcane Signet","Swords to Plowshares"],e.Ramp=["Cultivate","Kodama's Reach","Rampant Growth","Farseek"]),e}generateExplanation(t){const e=[`${t.name} offers unique gameplay with ${t.oracle_text?"powerful abilities":"interesting mechanics"} that can lead to exciting deck building opportunities.`,`This commander excels in ${t.color_identity.length>1?"multicolor":"focused"} strategies and provides great value for creative deck builders.`,`${t.name} is perfect for players who enjoy ${t.color_identity.includes("U")?"control and card draw":t.color_identity.includes("R")?"aggressive strategies":t.color_identity.includes("G")?"ramp and big creatures":t.color_identity.includes("B")?"graveyard synergies":"protection and lifegain"} themes.`];return e[Math.floor(Math.random()*e.length)]}displayDeckSuggestions(){const t=document.getElementById("deck-content"),e=this.currentCommander;if(!e.deckSuggestions||Object.keys(e.deckSuggestions).length===0){this.displayBasicDeckSuggestions();return}let a=`
            <div style="text-align: center; margin-bottom: 20px;">
                <h3>Building around ${e.name}</h3>
                <p>Popular cards from EDHREC and Scryfall data:</p>
            </div>
        `;Object.entries(e.deckSuggestions).forEach(([n,r])=>{r&&r.length>0&&(a+=`
                    <div class="deck-category">
                        <h3>${n}</h3>
                        <div class="card-list">
                            ${r.map(o=>`<span class="card-suggestion">${o}</span>`).join("")}
                        </div>
                    </div>
                `)}),t.innerHTML=a}displayBasicDeckSuggestions(){const t=document.getElementById("deck-content"),e=this.currentCommander,a={Staples:["Sol Ring","Command Tower","Arcane Signet","Lightning Greaves"],Ramp:["Cultivate","Kodama's Reach","Rampant Growth","Nature's Lore"],Removal:["Swords to Plowshares","Path to Exile","Beast Within","Generous Gift"],"Card Draw":["Rhystic Study","Mystic Remora","Phyrexian Arena","Sylvan Library"]};let n=`
            <div style="text-align: center; margin-bottom: 20px;">
                <h3>Building around ${e.name}</h3>
                <p>Basic deck building recommendations:</p>
            </div>
        `;Object.entries(a).forEach(([r,o])=>{n+=`
                <div class="deck-category">
                    <h3>${r}</h3>
                    <div class="card-list">
                        ${o.map(c=>`<span class="card-suggestion">${c}</span>`).join("")}
                    </div>
                </div>
            `}),t.innerHTML=n}rejectCommander(){console.log("Reject commander called");const t=document.getElementById("card-container"),e=document.getElementById("loading-screen"),a=document.getElementById("swipe-hint"),n=document.getElementById("swipe-buttons");setTimeout(()=>{this.commanderQueue.length>0?(console.log("Getting commander from queue. Remaining:",this.commanderQueue.length),this.currentCommander=this.commanderQueue.shift(),this.displayCommander(),this.commanderQueue.length<this.minQueueSize&&(console.log("Queue low, prefetching in background..."),this.prefetchCommanders().catch(r=>console.log("Background prefetch failed:",r)))):(t.style.display="none",a.style.display="none",n.style.display="none",e.style.display="block",this.fetchRandomCommander().then(r=>{console.log("New commander fetched:",r.name),this.currentCommander=r,this.displayCommander()}).catch(r=>{console.error("Error fetching new commander:",r),e.innerHTML='<div style="text-align: center; padding: 40px; color: #ff5252;">‚ùå Error loading commander. Please try again.</div>'}))},350)}resetToFilters(){document.getElementById("card-section").style.display="none",document.getElementById("deck-suggestions").style.display="none",window.scrollTo({top:0,behavior:"smooth"})}}document.addEventListener("DOMContentLoaded",()=>{new g});
